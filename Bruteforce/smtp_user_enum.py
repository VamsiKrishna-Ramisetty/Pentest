import argparse
import smtplib
import sys
from colorama import Fore as F,Back as B,Style as S

BB,BR,FT,FR,FG,FY,FB,FM,FC,ST,SD,SB = B.BLACK,B.RED,F.RESET,F.RED,F.GREEN,F.YELLOW,F.BLUE,F.MAGENTA,F.CYAN,S.RESET_ALL,S.DIM,S.BRIGHT

valid_users=[]

def main():
    print(SB,end="")
    print(FG,end="")
    parser = argparse.ArgumentParser()
    parser.add_argument("-T",help="Target",type=str)
    parser.add_argument("-L",help="Usernames Wordlist",type=str)
    parser.add_argument("-V",help="Verbose Mode",action="store_true")
    parser.add_argument("-q",help="Quite banner",action="store_true")
    args=parser.parse_args()
    
    if(args.L and args.T):
        usernames=args.L
        target=args.T
        verbose=args.V
    else:
        print("[-] Missing Parmeters Usage python3 smtp_user_enum.py -h")
        sys.exit(0)
    
    if(args.q):
        print("",end="")
    else:
        signature()
 
    print("[*] SMTP User Enumeration with Python")
    print("[+] Target Server : "+target)
    print("[+] Usernames Wordlist : "+usernames)
    
    if(verbose):
        print("[+] Verbose Mode : ON")
    else:
        print("[+] Verbose Mode : OFF")

    enumeration(target,usernames,verbose)

    if(len(valid_users)==0):
        print("[-] No Valid Users Found ")
        sys.exit(0)
    else:
        print("[*] Valid Users : ")
        for u in valid_users:
            print("[+] "+u)

def enumeration(target,usernames,verbose):

    print("[*] Enumerating Valid Users")
    
    try :
        with open(usernames) as users:
            for user in users:
                user=user.strip()
                if(verbose):
                    print("[+] Checking "+user)
                server=smtplib.SMTP(target)     
                vrfy=server.verify(user)
                if(vrfy[0]==252):
                    print("[*] Found Valid User : "+user)
                    valid_users.append(user)
                else:
                    pass
                server.close()
    except :

        print("[-] Invalid Users file ")
        sys.exit(0)        

def signature():
    header = "\n"+SB+FT+''+FR+'* * * * * * * * Vamsikrishna '+FR+'"'+FT+'V3GETA'+FR+'"'+FR+' Ramisetty * * * * * * * *\n'+ST
    print(header)
    SIG =""
    SIG+=FR+"     ██    ██ "+FT+"██████"+FY+"   ██████"+FT+"  ███████"+FB+" ████████"+FG+"  █████\n"
    SIG+=FR+"     ██    ██ "+FT+"     ██"+FY+" ██       "+FT+"██        "+FB+" ██"+FG+"    ██   ██ \n"
    SIG+=FR+"     ██    ██ "+FT+" █████"+FY+"  ██   ███"+FT+" █████   "+FB+"   ██"+FG+"    ███████ \n"
    SIG+=FR+"      ██  ██  "+FT+"     ██"+FY+" ██    ██"+FT+" ██        "+FB+" ██"+FG+"    ██   ██ \n"
    SIG+=FR+"       ████   "+FT+"██████"+FY+"   ██████"+FT+"  ███████ "+FB+"   ██"+FG+"    ██   ██ \n"
    SIG+="\n"
    SIG+=SB+""+FY+"      _______"+FR+"github.com/VamsiKrishna-Ramisetty"+FY+"_______\n"
    SIG+=FR+"\n* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * \n" 
    print(SIG)
    print(FG,end="")

if __name__ == '__main__':
    main()

