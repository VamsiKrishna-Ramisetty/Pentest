#Lab: Broken brute-force protection, multiple credentials per request
#not coded done in burpsuite

import requests
import sys
import urllib3
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

proxies={'http':'http://127.0.0.1:8080','https':'http://127.0.0.1:8080'}

s=requests.Session()

def main():

    try:
        url=sys.argv[1].strip()
        usernames=sys.argv[2].strip()
        passwords=sys.argv[3].strip()
        print("[+] Enumerating Passwords")

        valid_pass=enumerate_password(s,usernames,passwords)
        if(valid_pass):
            print('[+] Found valid credentials : '+usernames+' : '+valid_pass)
        else:
            print('[-] Not Found valid credentials')
    except IndexError:
        print('[-] Missing Parameters ')
        print('[*] Usage python <url> usernames passwords')

def enumerate_password(s,url,usernames,passwords):

    s.get(url,proxies=proxies,verif=False)
    try :
        with open(passwords) as password:
            for passwd in password:
                passwd=passwd.strip()

    except KeyboardInterrupt:
        print("[-] Keyboard Interrupt,Quitting the Program")
        sys.exit()
    except TypeError:
        print('[+] Data Type concatenation mismatch')
        sys.exit()
    except :
        print("[-] Invalid Users file ")
        sys.exit(0)